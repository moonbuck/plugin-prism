{{/* Determine the theme and resolve whether to use minified CSS and Javascript */}}
{{ $theme := site.Params.prismjs_theme | default "moondeer" }}
{{ $minify := true }}
{{ if (and (site.Params.prismjs_minify) (eq site.Params.prismjs_minify "false")) }}
{{ $minify = false }}
{{ end }}

{{/* Link the stylesheet for the theme */}}
<link rel="stylesheet" href="/assets/css/themes/prism-{{ $theme }}{{ with $minify }}.min{{ end }}.css">


{{/* Link the scripts */}}
<script src="/assets/js/prism-core{{ with $minify }}.min{{ end }}.js"></script>
{{ $plugin_dir := "/assets/js/plugins" }}
<script srtc="{{ $plugin_dir }}/autoloader/prism-autoloader{{ with $minify }}.min{{ end }}.js"></script>
<script srtc="{{ $plugin_dir }}/unescaped-markup/prism-unescaped-markup{{ with $minify }}.min{{ end }}.js"></script>
<script srtc="{{ $plugin_dir }}/keep-markup/prism-keep-markup{{ with $minify }}.min{{ end }}.js"></script>
<script srtc="{{ $plugin_dir }}/custom-class/prism-custom-class{{ with $minify }}.min{{ end }}.js"></script>
<script srtc="{{ $plugin_dir }}/normalize-whitespace/prism-normalize-whitespace{{ with $minify }}.min{{ end }}.js"></script>
<script srtc="{{ $plugin_dir }}/highlight-keywords/prism-highlight-keywords{{ with $minify }}.min{{ end }}.js"></script>
<script srtc="{{ $plugin_dir }}/line-numbers/prism-line-numbers{{ with $minify }}.min{{ end }}.js"></script>

{{ if not (and site.Params.prismjs_enable_toolbar (eq site.Params.prismjs_enable_toolbar "false")) }}
<script srtc="{{ $plugin_dir }}/toolbar/prism-toolbar{{ with $minify }}.min{{ end }}.js"></script>

{{ if not (and site.Params.prismjs_show_language (eq site.Params.prismjs_show_language "false")) }}
<script srtc="{{ $plugin_dir }}/show-language/prism-show-language{{ with $minify }}.min{{ end }}.js"></script>
{{ end }}

{{ if not (and site.Params.prismjs_copy_button (eq site.Params.prismjs_copy_button "false")) }}
<script srtc="{{ $plugin_dir }}/copy-to-clipboard/prism-copy-to-clipboard{{ with $minify }}.min{{ end }}.js"></script>
{{ end }}

{{ end }}

{{/* Inject a style tag enforcing the desired font size */}}
{{ $font_size := site.Params.prismjs_font_size | default "0.5rem" }}
<style>code[class*=language-],pre[class*=language-]{font-size:{{ $font_size }}!important}</style>

{{/* Determine whether to soft-wrap code */}}
{{ if not (and (site.Params.prismjs_soft_wrap) (eq site.Params.prismjs_soft_wrap "false")) }}
<style>pre.code-block{white-space:pre-wrap}</style>
{{ end }}

{{/* Set class prefix if specified */}}
{{ with site.Params.prismjs_class_prefix }}
<script>
Prism.plugins.customClass.prefix('{{ . }}');
</script>
{{ end }}

{{/* Load class map if provided */}}
{{ with site.Params.prismjs_class_map }}
<script>
Prism.plugins.customClass.map({{ . }});
</script>
{{ end }}

{{/* Determine whether whitespace normalization should be customized */}}
{{ with site.Params.prismjs_whitespace_settings_json }}
{{ with transform.Unmarshal .}}

<script>
Prism.plugins.NormalizeWhitespace.setDefaults({
  {{ with .remove_trailing }}'remove-trailing': {{ . }},{{ end }}
  {{ with .remove_indent }}'remove-indent': {{ . }},{{ end }}
  {{ with .left_trim }}'left-trim': {{ . }},{{ end }}
  {{ with .right_trim }}'right-trim': {{ . }},{{ end }}
  {{ with .break_lines }}'break-lines': {{ . }},{{ end }}
  {{ with .indent }}'indent': {{ . }},{{ end }}
  {{ with .remove_initial_line_feed }}'remove-initial-line-feed': false,{{ end }}
  {{ with .tabs_to_spaces }}'tabs-to-spaces': {{ . }},{{ end }}
  {{ with .spaces_to_tabs }}'spaces-to-tabs': {{ . }}{{ end }}
});
</script>

{{ end }}
{{ end }}